"use strict";(()=>{var e={};e.id=3744,e.ids=[3744],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},3007:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>h,patchFetch:()=>N,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var s={};o.r(s),o.d(s,{GET:()=>c,PUT:()=>d});var t=o(9303),n=o(8716),i=o(670),a=o(7070),u=o(728),l=o(5456);async function c(e){console.log("=== USER PROFILE API CALLED ===");try{let r=e.headers.get("authorization")?.replace("Bearer ","");if(console.log("Token from Authorization header:",r?"EXISTS":"NOT FOUND"),r||(r=e.cookies.get("token")?.value,console.log("Token from cookies:",r?"EXISTS":"NOT FOUND")),!r)return console.log("No token found anywhere, returning 401"),a.NextResponse.json({error:"Nicht angemeldet",success:!1},{status:401});console.log("Verifying token...");let o=(0,l.WX)(r);if(!o)return console.log("Token verification failed, returning 401"),a.NextResponse.json({error:"Ung\xfcltiger Token",success:!1},{status:401});console.log("Token verified, userId:",o.userId);let s=await u._.user.findUnique({where:{id:o.userId},select:{id:!0,username:!0,inGameName:!0,inGameRank:!0,discordName:!0,twitchName:!0,instagramName:!0,tier:!0,isVerified:!0,rulesAccepted:!0,twitchVerified:!0,instagramVerified:!0,discordVerified:!0,inGameNameVerified:!0,inGameRankVerified:!0}});if(!s)return console.log("User not found in database for userId:",o.userId),a.NextResponse.json({error:"Benutzer nicht gefunden",success:!1},{status:404});return console.log("User found, returning profile data:",s),a.NextResponse.json({success:!0,user:s})}catch(e){return console.error("Profile fetch error:",e),a.NextResponse.json({error:"Interner Serverfehler",success:!1},{status:500})}}async function d(e){console.log("=== USER PROFILE UPDATE API CALLED ===");try{let r=e.headers.get("authorization")?.replace("Bearer ","");if(console.log("Token from Authorization header:",r?"EXISTS":"NOT FOUND"),r||(r=e.cookies.get("token")?.value,console.log("Token from cookies:",r?"EXISTS":"NOT FOUND")),!r)return console.log("No token found anywhere, returning 401"),a.NextResponse.json({error:"Nicht angemeldet",success:!1},{status:401});console.log("Verifying token...");let o=(0,l.WX)(r);if(!o)return console.log("Token verification failed, returning 401"),a.NextResponse.json({error:"Ung\xfcltiger Token",success:!1},{status:401});console.log("Token verified, userId:",o.userId);let{inGameName:s,inGameRank:t,discordName:n,twitchName:i,instagramName:c}=await e.json();console.log("Update data:",{inGameName:s,inGameRank:t,discordName:n,twitchName:i,instagramName:c});let d=await u._.user.update({where:{id:o.userId},data:{inGameName:s||null,inGameRank:t||null,discordName:n||null,twitchName:i||null,instagramName:c||null},select:{id:!0,username:!0,inGameName:!0,inGameRank:!0,discordName:!0,twitchName:!0,instagramName:!0,tier:!0,isVerified:!0,rulesAccepted:!0}});return console.log("User updated successfully:",d),a.NextResponse.json({success:!0,message:"Profil aktualisiert",user:d})}catch(e){return console.error("Profile update error:",e),a.NextResponse.json({error:"Interner Serverfehler",success:!1},{status:500})}}let p=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"C:\\Users\\hAiQ\\Desktop\\cup\\src\\app\\api\\user\\profile\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:m}=p,h="/api/user/profile/route";function N(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},5456:(e,r,o)=>{o.d(r,{Gv:()=>a,RA:()=>u,WX:()=>l,c_:()=>i});var s=o(8691),t=o(1482),n=o.n(t);let i=async e=>s.ZP.hash(e,12),a=async(e,r)=>s.ZP.compare(e,r),u=e=>n().sign({userId:e},process.env.JWT_SECRET,{expiresIn:"7d"}),l=e=>{try{return n().verify(e,process.env.JWT_SECRET)}catch{return null}}},728:(e,r,o)=>{o.d(r,{_:()=>t});let s=require("@prisma/client"),t=globalThis.prisma??new s.PrismaClient({})}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),s=r.X(0,[8948,5972,1482,8691],()=>o(3007));module.exports=s})();