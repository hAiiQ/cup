"use strict";(()=>{var e={};e.id=3744,e.ids=[3744,3538],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},3007:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>N,patchFetch:()=>k,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};o.r(s),o.d(s,{GET:()=>d,PUT:()=>p,dynamic:()=>c});var n=o(9303),t=o(8716),a=o(670),i=o(7070),l=o(3538),u=o(5456);let c="force-dynamic";async function d(e){console.log("=== USER PROFILE API CALLED ===");try{let r=e.headers.get("authorization")?.replace("Bearer ","");if(console.log("Token from Authorization header:",r?"EXISTS":"NOT FOUND"),r||(r=e.cookies.get("token")?.value,console.log("Token from cookies:",r?"EXISTS":"NOT FOUND")),!r)return console.log("No token found anywhere, returning 401"),i.NextResponse.json({error:"Nicht angemeldet",success:!1},{status:401});console.log("Verifying token...");let o=(0,u.WX)(r);if(!o)return console.log("Token verification failed, returning 401"),i.NextResponse.json({error:"Ung\xfcltiger Token",success:!1},{status:401});console.log("Token verified, userId:",o.userId);let s=await l.prisma.user.findUnique({where:{id:o.userId},select:{id:!0,username:!0,inGameName:!0,inGameRank:!0,discordName:!0,twitchName:!0,instagramName:!0,tier:!0,isVerified:!0,rulesAccepted:!0,twitchVerified:!0,instagramVerified:!0,discordVerified:!0,inGameNameVerified:!0,inGameRankVerified:!0}});if(!s)return console.log("User not found in database for userId:",o.userId),i.NextResponse.json({error:"Benutzer nicht gefunden",success:!1},{status:404});return console.log("User found, returning profile data:",s),i.NextResponse.json({success:!0,user:s})}catch(e){return console.error("Profile fetch error:",e),i.NextResponse.json({error:"Interner Serverfehler",success:!1},{status:500})}}async function p(e){console.log("=== USER PROFILE UPDATE API CALLED ===");try{let r=e.headers.get("authorization")?.replace("Bearer ","");if(console.log("Token from Authorization header:",r?"EXISTS":"NOT FOUND"),r||(r=e.cookies.get("token")?.value,console.log("Token from cookies:",r?"EXISTS":"NOT FOUND")),!r)return console.log("No token found anywhere, returning 401"),i.NextResponse.json({error:"Nicht angemeldet",success:!1},{status:401});console.log("Verifying token...");let o=(0,u.WX)(r);if(!o)return console.log("Token verification failed, returning 401"),i.NextResponse.json({error:"Ung\xfcltiger Token",success:!1},{status:401});console.log("Token verified, userId:",o.userId);let{inGameName:s,inGameRank:n,discordName:t,twitchName:a,instagramName:c}=await e.json();console.log("Update data:",{inGameName:s,inGameRank:n,discordName:t,twitchName:a,instagramName:c});let d=await l.prisma.user.update({where:{id:o.userId},data:{inGameName:s||null,inGameRank:n||null,discordName:t||null,twitchName:a||null,instagramName:c||null},select:{id:!0,username:!0,inGameName:!0,inGameRank:!0,discordName:!0,twitchName:!0,instagramName:!0,tier:!0,isVerified:!0,rulesAccepted:!0}});return console.log("User updated successfully:",d),i.NextResponse.json({success:!0,message:"Profil aktualisiert",user:d})}catch(e){return console.error("Profile update error:",e),i.NextResponse.json({error:"Interner Serverfehler",success:!1},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"C:\\Users\\hAiQ\\Desktop\\cup\\src\\app\\api\\user\\profile\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h}=f,N="/api/user/profile/route";function k(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},5456:(e,r,o)=>{o.d(r,{Gv:()=>i,RA:()=>l,WX:()=>u,c_:()=>a});var s=o(8691),n=o(1482),t=o.n(n);let a=async e=>s.ZP.hash(e,12),i=async(e,r)=>s.ZP.compare(e,r),l=e=>{let r=process.env.JWT_SECRET||"tournament-secret-key-2024-fallback";return t().sign({userId:e},r,{expiresIn:"7d"})},u=e=>{try{let r=process.env.JWT_SECRET||"tournament-secret-key-2024-fallback";return t().verify(e,r)}catch{return null}}},3538:(e,r,o)=>{o.d(r,{prisma:()=>t});var s=o(3524);let n=globalThis;process.env.DATABASE_URL||(console.error("❌ DATABASE_URL environment variable is not set!"),console.log("\uD83D\uDD27 Please set DATABASE_URL in your Render environment variables"));let t=n.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});t.$connect().then(()=>{console.log("✅ Database connected successfully")}).catch(e=>{console.error("❌ Database connection failed:",e)})}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),s=r.X(0,[8948,5972,8691,1482],()=>o(3007));module.exports=s})();