"use strict";(()=>{var e={};e.id=7300,e.ids=[7300,3538],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},3771:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{POST:()=>p,dynamic:()=>m});var a=t(9303),s=t(8716),i=t(670),o=t(7070),c=t(3538),l=t(5456);async function u(e){let r=e.cookies.get("admin_token")?.value;if(!r)return null;let t=(0,l.WX)(r);if(!t||!t.userId.startsWith("admin_"))return null;let n=t.userId.replace("admin_","");return await c.prisma.admin.findUnique({where:{id:n}})}async function d(e,r){console.log(`ðŸ† Setting winner for match ${e}: ${r}`);let t=await c.prisma.match.findUnique({where:{id:e}});if(!t)throw Error("Match nicht gefunden");console.log(`ðŸ“‹ Match: Round ${t.round}, Bracket ${t.bracket}`),await c.prisma.match.update({where:{id:e},data:{winnerId:r,isFinished:!0}}),console.log(`âœ… Match winner set successfully`);let n=r===t.team1Id?t.team2Id:t.team1Id;return"winner"===t.bracket?console.log(`ðŸ† Winner bracket: Team ${r} advances, Team ${n} to loser bracket`):"loser"===t.bracket?console.log(`ðŸ’€ Loser bracket: Team ${r} advances, Team ${n} eliminated`):"grand"===t.bracket&&console.log(`ðŸŽ‰ TOURNAMENT WINNER: Team ${r}`),{success:!0,message:"Match winner set (simplified mode)",matchId:e,winnerId:r}}let m="force-dynamic";async function p(e,{params:r}){try{if(!await u(e))return o.NextResponse.json({error:"Nicht autorisiert"},{status:401});let{id:t}=r,{winnerId:n}=await e.json();if(!n)return o.NextResponse.json({error:"Gewinner-ID ist erforderlich"},{status:400});let a=await d(t,n);return o.NextResponse.json({success:!0,message:"Match-Ergebnis erfolgreich gespeichert",result:a})}catch(e){return console.error("Set match winner error:",e),o.NextResponse.json({error:e instanceof Error?e.message:"Interner Serverfehler"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/bracket/matches/[id]/winner/route",pathname:"/api/admin/bracket/matches/[id]/winner",filename:"route",bundlePath:"app/api/admin/bracket/matches/[id]/winner/route"},resolvedPagePath:"C:\\Users\\hAiQ\\Desktop\\cup\\src\\app\\api\\admin\\bracket\\matches\\[id]\\winner\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:v}=h,w="/api/admin/bracket/matches/[id]/winner/route";function b(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},5456:(e,r,t)=>{t.d(r,{Gv:()=>o,RA:()=>c,WX:()=>l,c_:()=>i});var n=t(8691),a=t(1482),s=t.n(a);let i=async e=>n.ZP.hash(e,12),o=async(e,r)=>n.ZP.compare(e,r),c=e=>{let r=process.env.JWT_SECRET||"tournament-secret-key-2024-fallback";return s().sign({userId:e},r,{expiresIn:"7d"})},l=e=>{try{let r=process.env.JWT_SECRET||"tournament-secret-key-2024-fallback";return s().verify(e,r)}catch{return null}}},3538:(e,r,t)=>{t.d(r,{prisma:()=>s});var n=t(3524);let a=globalThis;process.env.DATABASE_URL||(console.error("âŒ DATABASE_URL environment variable is not set!"),console.log("\uD83D\uDD27 Please set DATABASE_URL in your Render environment variables"));let s=a.prisma??new n.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});s.$connect().then(()=>{console.log("âœ… Database connected successfully")}).catch(e=>{console.error("âŒ Database connection failed:",e)})}};var r=require("../../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[8948,5972,8691,1482],()=>t(3771));module.exports=n})();