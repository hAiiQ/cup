"use strict";(()=>{var e={};e.id=7300,e.ids=[7300],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},3771:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>I,patchFetch:()=>k,requestAsyncStorage:()=>w,routeModule:()=>p,serverHooks:()=>_,staticGenerationAsyncStorage:()=>f});var r={};a.r(r),a.d(r,{POST:()=>l,dynamic:()=>h});var i=a(9303),n=a(8716),d=a(670),s=a(7070),o=a(728),c=a(5456);async function u(e){let t=e.cookies.get("admin_token")?.value;if(!t)return null;let a=(0,c.WX)(t);if(!a||!a.userId.startsWith("admin_"))return null;let r=a.userId.replace("admin_","");return await o._.admin.findUnique({where:{id:r}})}async function m(e,t){let a=await o._.match.findUnique({where:{id:e},include:{team1:!0,team2:!0}});if(!a)throw Error("Match nicht gefunden");await o._.match.update({where:{id:e},data:{winnerId:t,isComplete:!0}});let r=t===a.team1Id?a.team2Id:a.team1Id;if("winner"===a.bracket){if(1===a.round){let e=Math.ceil(a.position/2),i=await o._.match.findFirst({where:{bracket:"winner",round:2,position:e}});if(i){let e=a.position%2==1?{team1Id:t}:{team2Id:t};await o._.match.update({where:{id:i.id},data:e})}let n=Math.ceil(a.position/2),d=await o._.match.findFirst({where:{bracket:"loser",round:1,position:n}});if(d){let e=a.position%2==1?{team2Id:r}:{team1Id:r};await o._.match.update({where:{id:d.id},data:e})}}else if(2===a.round){let e=await o._.match.findFirst({where:{bracket:"winner",round:3,position:1}});if(e){let r=1===a.position?{team1Id:t}:{team2Id:t};await o._.match.update({where:{id:e.id},data:r})}let i=await o._.match.findFirst({where:{bracket:"loser",round:3,position:1}});i&&!i.team1Id?await o._.match.update({where:{id:i.id},data:{team1Id:r}}):i&&!i.team2Id&&await o._.match.update({where:{id:i.id},data:{team2Id:r}})}else if(3===a.round){let e=await o._.match.findFirst({where:{bracket:"grand",round:1,position:1}});e&&await o._.match.update({where:{id:e.id},data:{team1Id:t}});let a=await o._.match.findFirst({where:{bracket:"loser",round:4,position:1}});a&&!a.team1Id?await o._.match.update({where:{id:a.id},data:{team1Id:r}}):a&&!a.team2Id&&await o._.match.update({where:{id:a.id},data:{team2Id:r}})}}else if("loser"===a.bracket){if(1===a.round){let e=Math.ceil(a.position/2),r=await o._.match.findFirst({where:{bracket:"loser",round:2,position:e}});r&&!r.team2Id&&await o._.match.update({where:{id:r.id},data:{team2Id:t}})}else if(2===a.round){let e=await o._.match.findFirst({where:{bracket:"loser",round:3,position:1}});e&&!e.team2Id&&await o._.match.update({where:{id:e.id},data:{team2Id:t}})}else if(3===a.round){let e=await o._.match.findFirst({where:{bracket:"loser",round:4,position:1}});e&&!e.team2Id&&await o._.match.update({where:{id:e.id},data:{team2Id:t}})}else if(4===a.round){let e=await o._.match.findFirst({where:{bracket:"grand",round:1,position:1}});e&&!e.team2Id&&await o._.match.update({where:{id:e.id},data:{team2Id:t}})}}}let h="force-dynamic";async function l(e,{params:t}){try{if(!await u(e))return s.NextResponse.json({error:"Nicht autorisiert"},{status:401});let{id:a}=t,{winnerId:r}=await e.json();if(!r)return s.NextResponse.json({error:"Gewinner-ID ist erforderlich"},{status:400});return await m(a,r),s.NextResponse.json({success:!0,message:"Match-Ergebnis erfolgreich gespeichert"})}catch(e){return console.error("Set match winner error:",e),s.NextResponse.json({error:e instanceof Error?e.message:"Interner Serverfehler"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/bracket/matches/[id]/winner/route",pathname:"/api/admin/bracket/matches/[id]/winner",filename:"route",bundlePath:"app/api/admin/bracket/matches/[id]/winner/route"},resolvedPagePath:"C:\\Users\\hAiQ\\Desktop\\cup\\src\\app\\api\\admin\\bracket\\matches\\[id]\\winner\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:_}=p,I="/api/admin/bracket/matches/[id]/winner/route";function k(){return(0,d.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:f})}},5456:(e,t,a)=>{a.d(t,{Gv:()=>s,RA:()=>o,WX:()=>c,c_:()=>d});var r=a(8691),i=a(1482),n=a.n(i);let d=async e=>r.ZP.hash(e,12),s=async(e,t)=>r.ZP.compare(e,t),o=e=>{let t=process.env.JWT_SECRET||"tournament-secret-key-2024-fallback";return n().sign({userId:e},t,{expiresIn:"7d"})},c=e=>{try{let t=process.env.JWT_SECRET||"tournament-secret-key-2024-fallback";return n().verify(e,t)}catch{return null}}},728:(e,t,a)=>{a.d(t,{_:()=>n});let r=require("@prisma/client"),i=globalThis;process.env.DATABASE_URL||(console.error("âŒ DATABASE_URL environment variable is not set!"),console.log("\uD83D\uDD27 Please set DATABASE_URL in your Render environment variables"));let n=i.prisma??new r.PrismaClient({})}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,1482,8691],()=>a(3771));module.exports=r})();